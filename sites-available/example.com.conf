# An example of site configuration
#
# Replace example.com to actual domain
# If this site is not a default_server, remove default_server for all listen config
#
upstream app-frontend {
    # Example address of app frontend
    server localhost:3000;
    # If using nginx inside docker, then can use container name in same network
    # Example1: server container-name:exposed-container-port;
    # Example2: server app-fontend:3000;
}
server {
    listen 80 default_server;
    listen [::]:80 default_server;
    server_name example.com www.example.com;

    # Location for acme challenge
    location ~ /.well-known/acme-challenge {
        allow all;
        root /var/www/html;
    }

    # General Location
    location / {
        return 301 https://example.com$request_uri;
    }
}
server {
    listen 443 ssl http2 default_server;
    listen [::]:443 ssl http2 default_server;
    server_name example.com www.example.com;

    # Config for SSL which generated by letsencrypt
    ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;

    # Include this file for common SSL config
    include conf.d/ssl/ssl.conf;

    # Include this file for security config
    include conf.d/security/*.conf;

    # General Location
    location / {

        # Use proxy_pass if you want to use proxy, otherwise use try_files instead
        proxy_pass http://app-frontend;
        proxy_redirect off;

        # Include this file for proxy headers config
        include conf.d/location/proxy-headers.conf;
    }
}
